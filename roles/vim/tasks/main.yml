- name: Install vim
  ansible.builtin.apt:
    name:
      - vim
      - vim-nox
      - vim-addon-manager
  become: true

- name: Install vim plugin packages
  ansible.builtin.apt:
    name: vim-{{ item }}
  with_items: "{{ vim_plugin_package }}"
  become: true

- name: Install vim plugins
  ansible.builtin.command: vam install {{ item }}
  with_items: "{{ vim_plugin_package }}"

- name: Setup paths for vim
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items:
    - ~/.vim/autoload
    - ~/.vim/bundle
    - ~/.vim/ftplugin

- name: Set kotlin vim settings
  ansible.builtin.copy:
    dest: ~/.vim/ftplugin/kotlin.vim
    mode: '0644'
    content: |
      setlocal  tabstop=4
      setlocal  shiftwidth=4

- name: Install vim plugin
  ansible.builtin.git:
    repo: "{{ item.repo }}"
    dest: ~/.vim/bundle/{{ item.dest }}
  with_items:
    - {repo: "https://github.com/scrooloose/nerdtree.git", dest: nerdtree}
    - {repo: "https://github.com/Xuyuanp/nerdtree-git-plugin.git", dest: nerdtree-git-plugin}
    - {repo: "https://github.com/ntpeters/vim-better-whitespace.git", dest: vim-better-whitespace}
    - {repo: "https://github.com/airblade/vim-gitgutter.git", dest: vim-gitgutter}
    - {repo: "https://github.com/plasticboy/vim-markdown.git", dest: vim-markdown}
    - {repo: "https://github.com/IN3D/vim-raml.git", dest: vim-raml}
    - {repo: "https://github.com/aklt/plantuml-syntax.git", dest: plantuml-syntax}
    - {repo: "https://github.com/tfnico/vim-gradle.git", dest: vim-gradle}
    - {repo: "https://github.com/python-mode/python-mode.git", dest: python-mode}
    - {repo: "https://github.com/udalov/kotlin-vim.git", dest: kotlin-vim}

- name: Update .vimrc
  ansible.builtin.blockinfile:
    create: true
    marker: '"# {mark} ANSIBLE MANAGED BLOCK"'
    path: ~/.vimrc
    mode: '0644'
    block: |
      execute pathogen#infect()
      syntax on
      filetype plugin indent on
      :set tabstop=2
      :set shiftwidth=2
      :set expandtab
      :set nobackup
      :set noswapfile
      let g:vim_markdown_folding_style_pythonic = 1
      map <C-n> :NERDTreeToggle<CR>
      autocmd BufEnter * EnableStripWhitespaceOnSave

- name: Set vim as git editor
  community.general.git_config:
    name: core.editor
    scope: global
    value: vim
